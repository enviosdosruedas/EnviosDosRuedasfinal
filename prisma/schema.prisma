// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// --------------------------------------
// ENUMERACIONES
// --------------------------------------

enum Role {
  USER
  ADMIN
  REPARTIDOR
}

enum OrderStatusEnum {
  PENDIENTE
  EN_CURSO
  ENTREGADO
  CANCELADO
  DEVUELTO
}

enum ServiceTypeEnum {
  EXPRESS
  LOW_COST
  PUNTO_DE_RETIRO
}

enum SocialPlatformEnum {
  facebook
  instagram
  whatsapp
}

enum EtiquetaStatus {
  PENDIENTE
  IMPRESA
}

// --------------------------------------
// MODELOS DE DATOS
// --------------------------------------

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  name      String?
  role      Role     @default(USER)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  orders    Order[]
}

model Repartidor {
  id        Int      @id @default(autoincrement())
  name      String
  phone     String   @unique
  email     String?  @unique
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Client {
  id          Int      @id @default(autoincrement())
  name        String
  lastName    String?
  phone       String   @unique
  email       String?  @unique
  address     String
  addressLat  Decimal?
  addressLng  Decimal?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  orders      Order[]
}

model Order {
  id                      Int               @id @default(autoincrement())
  clientId                Int?
  client                  Client?           @relation(fields: [clientId], references: [id])
  clientNameAtOrder       String
  clientPhoneAtOrder      String
  status                  OrderStatusEnum   @default(PENDIENTE)
  serviceType             ServiceTypeEnum
  originFullName          String
  originPhone             String
  originAddress           String
  originLat               Decimal?
  originLng               Decimal?
  destinationContactName  String
  destinationContactPhone String
  destinationContactEmail String?
  destinationAddress      String
  destinationLat          Decimal?
  destinationLng          Decimal?
  distanceText            String?
  durationText            String?
  pickupDate              DateTime
  pickupTimeFrom          String
  pickupTimeTo            String
  deliveryDate            DateTime
  deliveryTimeFrom        String
  deliveryTimeTo          String
  pickupDateTime          DateTime
  deliveryDateTime        DateTime
  quotedPrice             Decimal?          @db.Decimal(10, 2)
  shippingCost            Decimal?          @db.Decimal(10, 2)
  totalCost               Decimal?          @db.Decimal(10, 2)
  createdAt               DateTime          @default(now())
  updatedAt               DateTime          @updatedAt
}

model Etiqueta {
  id                    Int             @id @default(autoincrement())
  orderNumber           String?         @unique
  tipoEnvio             ServiceTypeEnum
  remitenteNombre       String
  remitenteDireccion    String
  remitenteNotas        String?
  destinatarioNombre    String
  destinatarioDireccion String
  destinatarioTelefono  String
  montoACobrar          Decimal?        @db.Decimal(10, 2)
  destinatarioNotas     String?
  deliveryStartTime     String?
  deliveryEndTime       String?
  status                EtiquetaStatus  @default(PENDIENTE)
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt
}

model PriceRange {
  id             Int             @id @default(autoincrement())
  distanciaMinKm Decimal         @db.Decimal(10, 2)
  distanciaMaxKm Decimal         @db.Decimal(10, 2)
  precioRango    Decimal         @db.Decimal(10, 2)
  serviceType    ServiceTypeEnum
  isActive       Boolean         @default(true)
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt

  @@unique([distanciaMinKm, distanciaMaxKm, serviceType])
}

model SocialPost {
  id         Int                @id @default(autoincrement())
  platform   SocialPlatformEnum
  userName   String
  userAvatar String?
  userUrl    String?
  content    String             @db.Text
  postUrl    String             @unique
  imageUrl   String?
  imageHint  String?
  timestamp  DateTime
  likes      Int?
  comments   Int?
  shares     Int?
  createdAt  DateTime           @default(now())
  updatedAt  DateTime           @updatedAt
}
